@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    color-scheme: light;
    --background: 0 0% 100%;
    --foreground: 213 13% 14%;
    --card: 0 0% 100%;
    --card-foreground: 213 13% 14%;
    --popover: 0 0% 100%;
    --popover-foreground: 213 13% 14%;
    --primary: 212 92% 45%;
    --primary-foreground: 0 0% 100%;
    --secondary: 210 29% 97%;
    --secondary-foreground: 213 13% 14%;
    --muted: 210 29% 97%;
    --muted-foreground: 212 8% 43%;
    --accent: 199 100% 93%;
    --accent-foreground: 212 92% 45%;
    --destructive: 356 72% 47%;
    --destructive-foreground: 0 0% 100%;
    --border: 210 18% 84%;
    --input: 210 18% 84%;
    --ring: 212 92% 45%;
    --radius: 0.125rem;

    --ui-slate-950: 0 0% 100%;
    --ui-slate-900: 210 29% 97%;
    --ui-slate-800: 210 18% 84%;
    --ui-slate-700: 210 13% 72%;
    --ui-slate-100: 213 13% 14%;
    --ui-slate-200: 213 13% 16%;
    --ui-slate-300: 212 10% 38%;
    --ui-slate-400: 212 8% 43%;
    --ui-slate-500: 212 8% 47%;
    --ui-slate-600: 212 9% 59%;

    --scrollbar-track: 210 29% 97%;
    --scrollbar-thumb: 210 18% 84%;
    --scrollbar-thumb-hover: 210 13% 72%;

    --review-file-border: 210 18% 84%;
    --review-file-bg: 0 0% 100%;
    --review-header-border: 210 18% 84%;
    --review-header-text: 212 8% 43%;
    --review-row-border: 210 18% 87%;
    --review-row-comment-bg: 210 29% 97%;
    --review-row-select-bg: 199 100% 93%;
    --review-gutter-border: 210 18% 84%;
    --review-gutter-bg: 210 29% 97%;
    --review-gutter-text: 212 8% 43%;
    --review-gutter-hover-bg: 199 100% 93%;
    --review-gutter-hover-text: 213 13% 14%;
    --review-code-text: 213 13% 16%;
    --review-comment-cell-bg: 210 29% 97%;
  }

  .dark {
    color-scheme: dark;
    --background: 216 28% 7%;
    --foreground: 208 35% 93%;
    --card: 215 21% 11%;
    --card-foreground: 208 35% 93%;
    --popover: 215 21% 11%;
    --popover-foreground: 208 35% 93%;
    --primary: 215 93% 58%;
    --primary-foreground: 0 0% 100%;
    --secondary: 215 15% 15%;
    --secondary-foreground: 208 35% 93%;
    --muted: 215 15% 15%;
    --muted-foreground: 215 8% 53%;
    --accent: 216 84% 52%;
    --accent-foreground: 208 35% 93%;
    --destructive: 3 93% 63%;
    --destructive-foreground: 0 0% 100%;
    --border: 212 12% 21%;
    --input: 212 12% 21%;
    --ring: 215 93% 58%;

    --ui-slate-950: 216 28% 7%;
    --ui-slate-900: 215 21% 11%;
    --ui-slate-800: 215 15% 15%;
    --ui-slate-700: 212 12% 21%;
    --ui-slate-100: 208 35% 93%;
    --ui-slate-200: 210 17% 82%;
    --ui-slate-300: 212 14% 73%;
    --ui-slate-400: 212 9% 58%;
    --ui-slate-500: 215 8% 53%;
    --ui-slate-600: 215 8% 47%;

    --scrollbar-track: 216 28% 7%;
    --scrollbar-thumb: 212 12% 21%;
    --scrollbar-thumb-hover: 214 10% 31%;

    --review-file-border: 212 12% 21%;
    --review-file-bg: 216 28% 7%;
    --review-header-border: 212 12% 21%;
    --review-header-text: 215 8% 53%;
    --review-row-border: 215 15% 15%;
    --review-row-comment-bg: 215 21% 11%;
    --review-row-select-bg: 214 63% 17%;
    --review-gutter-border: 212 12% 21%;
    --review-gutter-bg: 216 28% 7%;
    --review-gutter-text: 215 8% 53%;
    --review-gutter-hover-bg: 216 72% 28%;
    --review-gutter-hover-text: 208 35% 93%;
    --review-code-text: 208 35% 93%;
    --review-comment-cell-bg: 215 21% 11%;
  }
}

@layer base {
  * {
    @apply border-border;
    border-radius: 0;
  }

  html,
  body,
  #root {
    min-height: 100%;
  }

  body {
    @apply bg-background text-foreground;
    margin: 0;
    min-height: 100vh;
    font-family: "SF Pro Text", "Avenir Next", "Helvetica Neue", "IBM Plex Sans", sans-serif;
    font-size: 13px;
    line-height: 1.45;
    letter-spacing: 0.005em;
  }

  code,
  pre,
  kbd,
  samp {
    font-family: "JetBrains Mono", "SFMono-Regular", Menlo, Monaco, monospace;
  }
}

::-webkit-scrollbar {
  width: 9px;
  height: 9px;
}

::-webkit-scrollbar-track {
  background: hsl(var(--scrollbar-track));
}

::-webkit-scrollbar-thumb {
  border: 2px solid hsl(var(--scrollbar-track));
  background: hsl(var(--scrollbar-thumb));
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--scrollbar-thumb-hover));
}

.markdown-content {
  @apply max-w-none text-foreground;
}

.markdown-content h1 {
  @apply mt-6 mb-3 border-b pb-2 text-xl font-semibold;
}

.markdown-content h2 {
  @apply mt-5 mb-2 text-lg font-semibold;
}

.markdown-content h3 {
  @apply mt-4 mb-2 text-base font-medium;
}

.markdown-content p {
  @apply my-2 leading-relaxed;
}

.markdown-content ul,
.markdown-content ol {
  @apply my-2 pl-6;
}

.markdown-content li {
  @apply my-1;
}

.markdown-content code {
  @apply bg-muted px-1.5 py-0.5 text-[12px] font-mono;
}

.markdown-content pre {
  @apply my-3 overflow-x-auto border border-border bg-muted p-3;
}

.markdown-content pre code {
  @apply bg-transparent p-0;
}

.markdown-content table {
  @apply my-3 w-full border-collapse;
}

.markdown-content th,
.markdown-content td {
  @apply border px-2 py-1.5 text-left;
}

.markdown-content th {
  @apply bg-muted font-medium;
}

.markdown-content blockquote {
  @apply my-3 border-l-2 border-muted pl-3 italic;
}

.markdown-content a {
  @apply text-primary underline;
}

.section-nav {
  @apply border bg-card p-2;
}

.section-nav-item {
  @apply block px-2 py-1 text-[12px] transition-colors;
}

.section-nav-item:hover {
  @apply bg-muted;
}

.markdown-content [id] {
  scroll-margin-top: 0.75rem;
}

.review-file {
  border: 1px solid hsl(var(--review-file-border));
  background: hsl(var(--review-file-bg));
}

.review-file-header {
  display: flex;
  justify-content: space-between;
  gap: 12px;
  border-bottom: 1px solid hsl(var(--review-header-border));
  padding: 8px 10px;
  font-size: 11px;
  color: hsl(var(--review-header-text));
}

.review-file-content {
  max-height: 64vh;
  overflow: auto;
}

.review-diff-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.review-diff-line {
  border-bottom: none;
}

.review-diff-line.has-comment {
  background: hsl(var(--review-row-comment-bg));
}

.review-diff-line.selecting {
  background: hsl(var(--review-row-select-bg));
}

.review-diff-gutter {
  width: 56px;
  cursor: pointer;
  border-right: 1px solid hsl(var(--review-gutter-border));
  background: hsl(var(--review-gutter-bg));
  padding: 0;
  color: hsl(var(--review-gutter-text));
}

.review-diff-gutter:hover {
  background: hsl(var(--review-gutter-hover-bg));
  color: hsl(var(--review-gutter-hover-text));
}

.review-line-num {
  display: inline-flex;
  width: 100%;
  align-items: center;
  justify-content: center;
  padding: 4px 0;
  font-size: 11px;
  font-family: "JetBrains Mono", "SFMono-Regular", Menlo, Monaco, monospace;
}

.review-add-btn {
  display: none;
}

.review-diff-code {
  padding: 4px 8px;
  white-space: pre-wrap;
  font-size: 12px;
  font-family: "JetBrains Mono", "SFMono-Regular", Menlo, Monaco, monospace;
  color: hsl(var(--review-code-text));
}

.review-comment-row {
  border-bottom: none;
}

.review-comment-cell {
  padding: 6px 8px;
  background: hsl(var(--review-comment-cell-bg));
}

.electron-drag-region {
  -webkit-app-region: drag;
}

.electron-no-drag {
  -webkit-app-region: no-drag;
}

/* Theme bridge for existing slate-based utility classes */
.bg-slate-950 {
  background-color: hsl(var(--ui-slate-950));
}

.bg-slate-950\/45 {
  background-color: hsl(var(--ui-slate-950) / 0.45);
}

.bg-slate-950\/95 {
  background-color: hsl(var(--ui-slate-950) / 0.95);
}

.bg-slate-900 {
  background-color: hsl(var(--ui-slate-900));
}

.bg-slate-900\/50 {
  background-color: hsl(var(--ui-slate-900) / 0.5);
}

.bg-slate-900\/60 {
  background-color: hsl(var(--ui-slate-900) / 0.6);
}

.bg-slate-900\/70 {
  background-color: hsl(var(--ui-slate-900) / 0.7);
}

.bg-slate-900\/80 {
  background-color: hsl(var(--ui-slate-900) / 0.8);
}

.bg-slate-800 {
  background-color: hsl(var(--ui-slate-800));
}

.bg-slate-800\/40 {
  background-color: hsl(var(--ui-slate-800) / 0.4);
}

.bg-slate-800\/70 {
  background-color: hsl(var(--ui-slate-800) / 0.7);
}

.bg-slate-700 {
  background-color: hsl(var(--ui-slate-700));
}

.border-slate-900,
.border-slate-800,
.border-slate-700,
.border-slate-600 {
  border-color: hsl(var(--border));
}

.text-slate-100 {
  color: hsl(var(--ui-slate-100));
}

.text-slate-200 {
  color: hsl(var(--ui-slate-200));
}

.text-slate-300 {
  color: hsl(var(--ui-slate-300));
}

.text-slate-400 {
  color: hsl(var(--ui-slate-400));
}

.text-slate-500 {
  color: hsl(var(--ui-slate-500));
}

.text-slate-600 {
  color: hsl(var(--ui-slate-600));
}

.hover\:bg-slate-900:hover {
  background-color: hsl(var(--ui-slate-900));
}

.hover\:bg-slate-800:hover {
  background-color: hsl(var(--ui-slate-800));
}

.hover\:bg-slate-800\/40:hover {
  background-color: hsl(var(--ui-slate-800) / 0.4);
}

.hover\:bg-slate-800\/70:hover {
  background-color: hsl(var(--ui-slate-800) / 0.7);
}

.hover\:text-slate-200:hover {
  color: hsl(var(--ui-slate-200));
}

.placeholder\:text-slate-500::placeholder {
  color: hsl(var(--ui-slate-500));
}

/* Milkdown theme: light mode (default) */
.milkdown {
  --crepe-color-background: transparent;
  --crepe-color-on-background: hsl(var(--foreground));
  --crepe-color-surface: hsl(var(--muted));
  --crepe-color-surface-low: hsl(var(--card));
  --crepe-color-on-surface: hsl(var(--foreground));
  --crepe-color-on-surface-variant: hsl(var(--muted-foreground));
  --crepe-color-outline: hsl(var(--muted-foreground));
  --crepe-color-primary: hsl(var(--primary));
  --crepe-color-secondary: hsl(var(--secondary));
  --crepe-color-on-secondary: hsl(var(--secondary-foreground));
  --crepe-color-inverse: hsl(var(--foreground));
  --crepe-color-on-inverse: hsl(var(--background));
  --crepe-color-inline-code: hsl(var(--destructive));
  --crepe-color-error: hsl(var(--destructive));
  --crepe-color-hover: hsl(var(--accent));
  --crepe-color-selected: hsl(var(--accent));
  --crepe-color-inline-area: hsl(var(--border));

  --crepe-font-title: inherit;
  --crepe-font-default: inherit;
  --crepe-font-code: "JetBrains Mono", "SFMono-Regular", "Menlo", "Monaco", monospace;

  --crepe-shadow-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
  --crepe-shadow-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
}

/* Milkdown theme: dark mode */
.dark .milkdown {
  --crepe-shadow-1:
    0px 1px 2px 0px rgba(255, 255, 255, 0.3), 0px 1px 3px 1px rgba(255, 255, 255, 0.15);
  --crepe-shadow-2:
    0px 1px 2px 0px rgba(255, 255, 255, 0.3), 0px 2px 6px 2px rgba(255, 255, 255, 0.15);
}

/* Milkdown editor integration */
.milkdown-editor-container {
  min-height: 200px;
}

.milkdown-editor-container .milkdown {
  outline: none;
}

.milkdown-editor-container .milkdown .ProseMirror {
  outline: none;
  min-height: 200px;
  overflow-y: auto;
  padding: 8px 4px;
  font-size: 13px;
  line-height: 1.45;
}

.milkdown-editor-container .milkdown .ProseMirror:focus {
  outline: none;
}

/* Override Crepe defaults (reset.css sets h1=42px, p=16px, padding=60px 120px) */
.milkdown-editor-container .milkdown .ProseMirror h1 {
  font-size: 20px;
  font-weight: 600;
  margin-top: 1.25rem;
  margin-bottom: 0.5rem;
  line-height: 1.3;
}

.milkdown-editor-container .milkdown .ProseMirror h2 {
  font-size: 17px;
  font-weight: 600;
  margin-top: 1rem;
  margin-bottom: 0.375rem;
  line-height: 1.3;
}

.milkdown-editor-container .milkdown .ProseMirror h3 {
  font-size: 15px;
  font-weight: 500;
  margin-top: 0.875rem;
  margin-bottom: 0.375rem;
  line-height: 1.3;
}

.milkdown-editor-container .milkdown .ProseMirror h4,
.milkdown-editor-container .milkdown .ProseMirror h5,
.milkdown-editor-container .milkdown .ProseMirror h6 {
  font-size: 13px;
  font-weight: 500;
  margin-top: 0.75rem;
  margin-bottom: 0.25rem;
  line-height: 1.3;
}

.milkdown-editor-container .milkdown .ProseMirror p {
  font-size: 13px;
  line-height: 1.45;
  padding: 2px 0;
}

/* CodeMirror active-line gutter: override default dark/light theme
   colors that don't match our app theme system. */
.milkdown-editor-container .milkdown .cm-activeLineGutter {
  background-color: hsl(var(--accent));
}

/* Prevent ProseMirror scroll jump on focus/selection change */
.milkdown-editor-container .ProseMirror .ProseMirror-gapcursor {
  display: none;
}
